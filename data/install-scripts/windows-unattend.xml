<libosinfo version="0.0.1">
  <install-script id='http://microsoft.com/windows/unattend'>
    <profile>jeos</profile>
    <config>
      <param name="admin-password" policy="optional"/>
      <param name="hardware-arch" policy="optional"/>
      <param name="l10n-language" policy="optional"/>
      <param name="user-login" policy="optional"/>
      <param name="user-password" policy="optional"/>
      <param name="user-realname" policy="optional"/>
      <param name="reg-product-key" policy="required"/>
    </config>
    <template filename="windows.xml">
      <xsl:stylesheet
        xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
        version="1.0">

        <xsl:output method="xml" indent="yes"/>

	<xsl:template name="arch">
	  <xsl:choose>
	    <xsl:when test="count(config/hardware-arch) &gt; 0">
	      <xsl:value-of select="config/hardware-arch"/>
	    </xsl:when>
	    <xsl:otherwise>
	      <xsl:text>x86</xsl:text>
	    </xsl:otherwise>
	  </xsl:choose>
	</xsl:template>

	<xsl:template match="/install-script-config">
	  <unattend xmlns="urn:schemas-microsoft-com:unattend">
	    <settings pass="windowsPE">
	      <component name="Microsoft-Windows-Setup" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<xsl:attribute name="processorArchitecture">
		  <xsl:call-template name="arch"/>
		</xsl:attribute>
		<DiskConfiguration>
		  <WillShowUI>OnError</WillShowUI>
		  <Disk>
		    <CreatePartitions>
		      <CreatePartition>
			<Order>1</Order>
			<Size>1</Size>
			<Type>Primary</Type>
		      </CreatePartition>
		    </CreatePartitions>
		    <DiskID>0</DiskID>
		    <WillWipeDisk>true</WillWipeDisk>
		    <ModifyPartitions>
		      <ModifyPartition>
			<Active>true</Active>
			<Extend>true</Extend>
			<Format>NTFS</Format>
			<Label>C drive</Label>
			<Letter>C</Letter>
			<Order>1</Order>
			<PartitionID>1</PartitionID>
		      </ModifyPartition>
		    </ModifyPartitions>
		  </Disk>
		</DiskConfiguration>
		<ImageInstall>
		  <OSImage>
		    <InstallFrom>
		      <MetaData wcm:action="add">
			<Key>/IMAGE/INDEX</Key>
			<Value>1</Value>
		      </MetaData>
		    </InstallFrom>
		    <InstallTo>
		      <DiskID>0</DiskID>
		      <PartitionID>1</PartitionID>
		    </InstallTo>
		    <WillShowUI>OnError</WillShowUI>
		  </OSImage>
		</ImageInstall>
		<UserData>
		  <AcceptEula>true</AcceptEula>
		</UserData>
	      </component>
	      <component name="Microsoft-Windows-International-Core-WinPE" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<xsl:attribute name="processorArchitecture">
		  <xsl:call-template name="arch"/>
		</xsl:attribute>
		<SetupUILanguage>
		  <UILanguage><xsl:value-of select="config/l10n-language"/></UILanguage>
		</SetupUILanguage>
		<SystemLocale><xsl:value-of select="config/l10n-language"/></SystemLocale>
		<UILanguage><xsl:value-of select="config/l10n-language"/></UILanguage>
		<UserLocale><xsl:value-of select="config/l10n-language"/></UserLocale>
	      </component>
	    </settings>
	    <settings pass="oobeSystem">
	      <component name="Microsoft-Windows-Shell-Setup" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<xsl:attribute name="processorArchitecture">
		  <xsl:call-template name="arch"/>
		</xsl:attribute>
		<UserAccounts>
		  <AdministratorPassword>
		    <Value><xsl:value-of select="config/admin-password"/></Value>
		    <PlainText>true</PlainText>
		  </AdministratorPassword>

		  <xsl:if test="count(config/user-login) &gt; 0">
		    <LocalAccounts>
		      <LocalAccount wcm:action="add">
			<Password>
			  <Value><xsl:value-of select="config/user-password"/></Value>
			  <PlainText>false</PlainText>
			</Password>
			<Name><xsl:value-of select="config/user-login"/></Name>
			<DisplayName><xsl:value-of select="config/user-realname"/></DisplayName>
			<Group>users</Group>
		      </LocalAccount>
		    </LocalAccounts>
		  </xsl:if>
		</UserAccounts>
		<xsl:if test="count(config/user-login) &gt; 0">
		  <AutoLogon>
		    <Password>
		      <Value><xsl:value-of select="config/user-password"/></Value>
		      <PlainText>true</PlainText>
		    </Password>
		    <Enabled>true</Enabled>
		    <LogonCount>5</LogonCount>
		    <Username><xsl:value-of select="config/user-login"/></Username>
		  </AutoLogon>
		</xsl:if>
		<OOBE>
		  <NetworkLocation>Work</NetworkLocation>
		  <HideEULAPage>true</HideEULAPage>
		  <ProtectYourPC>3</ProtectYourPC>
		  <SkipMachineOOBE>true</SkipMachineOOBE>
		  <SkipUserOOBE>true</SkipUserOOBE>
		</OOBE>
		<FirstLogonCommands>
		  <SynchronousCommand wcm:action="add">
		    <Order>1</Order>
		    <Description>Turn Off Network Selection pop-up</Description>
		    <CommandLine>cmd /c reg add "HKLM\SYSTEM\CurrentControlSet\Control\Network\NewNetworkWindowOff"</CommandLine>
		  </SynchronousCommand>
		  <SynchronousCommand wcm:action="add">
		    <Order>2</Order>
		    <Description>Shutting down Windows</Description>
		    <CommandLine>cmd /C shutdown /s /t 0</CommandLine>
		  </SynchronousCommand>
		</FirstLogonCommands>
	      </component>
	    </settings>
	    <settings pass="specialize">
	      <component name="Microsoft-Windows-Shell-Setup" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<xsl:attribute name="processorArchitecture">
		  <xsl:call-template name="arch"/>
		</xsl:attribute>

		<ProductKey><xsl:value-of select="config/reg-product-key"/></ProductKey>
	      </component>
	    </settings>
	  </unattend>
	</xsl:template>
      </xsl:stylesheet>
    </template>
  </install-script>
</libosinfo>
